# Deep Framework

## Project Principles

### Obtaining an Associative Field
Initialization and work with associative fields begin with `newDeep()`. In the future, support for restoring state from long-term memory (e.g., external databases) is planned.

### Primary Deep Association
Calls to `new deep()` or `deep()` are equivalent and create a new association, the type of which defaults to `deep` itself:
```typescript
const deep = newDeep();
const newInstance = new deep();
expect(newInstance.type.is(deep)).toBe(true);

const anotherInstance = deep();
expect(anotherInstance.type.is(deep)).toBe(true);
```

### Typing
When creating an instance based on another association, its type (`_type`) is automatically set to the ID of that parent association:
```typescript
const deep = newDeep();
const a = new deep(); // a._type === deep._id
expect(a.type.is(deep)).toBe(true);

const b = new a();    // b._type === a._id
expect(b.type.is(a)).toBe(true);

const c = new b();    // c._type === b._id
expect(c.type.is(b)).toBe(true);
```

### Data Types
The framework provides wrappers for basic JavaScript data types. This allows them to be integrated into the Deep association system and to track links and changes.

*   **Function**: Wrapper for functions (`new deep.Function(fn)`). Stores `fn` in `._data`.
*   **String**: Wrapper for strings (`new deep.String(str)`). Stores `str` in `._data`.
*   **Number**: Wrapper for numbers (`new deep.Number(num)`). Stores `num` in `._data`.
*   **Set**: Wrapper for `Set` (`new deep.Set(jsSet)`). Stores `jsSet` (with "raw" values) in `._data`.
*   *(Planned: Boolean, Array, Object, Map, Date, RegExp, etc.)*

### Values: `.value`, `.val`, `.data`

*   **.value**: A direct link to another Deep association for delegation or specifying a default value.
*   **.val**: Recursively follows `.value` to the terminal association (or until a cycle is detected).
*   **.data**: Accessor to the "raw" data in `this.val._data`. Reading returns raw data. Writing (if `this.val` has a type handler) writes raw data and triggers events.

### Core Links: `.type`, `.from`, `.to`
Define the type, source, and target for the current association, managing context inheritance and graph relationships.

### Data Handling
Key principle: methods and fields for data manipulation (e.g., `add` for Set, `push` for Array, `length` for String/Array) should be accessible from any Deep instance that represents a collection or data structure.

1.  **Universal Access:** Methods like `.add()`, `.delete()`, `.clear()`, `.has()`, `.size` (and other type-specific ones) are directly available on Deep instances (e.g., `myDeepSet.add(newItem)`).
2.  **Delegation via `.val`**: When such a method is called, it first finds the terminal association via `.val` (e.g., `resolvedInstance = myDeepSet.val`). Then, the corresponding method is called on `resolvedInstance` (specifically, on its `._data`).
3.  **Argument Wrapping (`deep.detect`)**:
    *   If a value that is not a Deep instance (e.g., a regular string, number) is passed to a method, it is automatically wrapped in the corresponding Deep type using `deep.detect(value)`. For example, `myDeepSet.add("text")` will result in "text" being processed as `new deep.String("text")`.
    *   Subsequently, for the actual operation with "raw" data (e.g., adding to a JavaScript `Set`), its "raw" value (`._data`) is extracted from the wrapped Deep instance.
4.  **Storage of "Raw" Data**: Inside the `._data` of typed Deep instances (like `String`, `Number`, `Set`), "raw" JavaScript values are stored, **not** other Deep instances.
    *   Example: `collection = new deep.Set(new Set())`, `collection.add(new deep.String("abc"))`. The internal `collection._data` will be a JavaScript `Set` containing `"abc"` (the string), not an instance of `deep.String`.
5.  **Return Values**:
    *   **Predictable JS Methods**: Methods and properties that have predictable behavior in standard JavaScript and return primitive types should aim to return those same primitive types for a native feel. For example:
        *   `.size` (for `Set`, `Map`), `.length` (for `String`, `Array`) should return a primitive `number`.
        *   `.has(value)` (for `Set`, `Map`) should return a primitive `boolean`.
        *   `.delete(value)` (for `Set`, `Map`) should return a primitive `boolean` (indicating the success of the operation).
    *   **Methods Returning Elements or New Deep Entities**: Methods that inherently return collection elements (e.g., `getItem`, `pop`, the result of `map` or `filter` if elements are complex) or create/modify the Deep entity itself (e.g., `add` on a `Set` often returns the `Set` itself for chaining) will return Deep instances. These Deep instances are wrapped using `deep.detect()`, allowing immediate use of all Deep capabilities (e.g., finding out who references this returned element).

#### Table of Methods and Properties for JavaScript Data Types

| Method/Property                                                                 | Common `.val` forwarding | `deep.String` accepts / returns      | `deep.Number` accepts / returns     | `deep.Boolean` accepts / returns    | `deep.Set` accepts / returns      | `deep.Array` accepts / returns      | `deep.Object` accepts / returns     | `deep.Map` accepts / returns    | `deep.Date` accepts / returns    | `deep.RegExp` accepts / returns    |
|---------------------------------------------------------------------------------|--------------------------|--------------------------------------|---------------------------------------|-----------------------------------------|-----------------------------------|---------------------------------------|----------------------------------------|---------------------------------|------------------------------------|----------------------------------------|
| `toString()`                                                                    | ⚙️                       | `-` / `string`                       | `-` / `string`                        | `-` / `string`                          | `-` / `string`                    | `-` / `string`                        | `-` / `string`                         | `-` / `string`                  | `-` / `string`                     | `-` / `string`                         |
| `valueOf()`                                                                     | ⚙️                       | `-` / `string`                       | `-` / `number`                        | `-` / `boolean`                         | `-` / `this (deep.Set)`           | `-` / `this (deep.Array)`             | `-` / `this (deep.Object)`             | `-` / `this (deep.Map)`           | `-` / `number` (timestamp)         | `-` / `this (deep.RegExp)`             |
| `hasOwnProperty(prop: string \| deep.String)`                                    | ⚙️                       | `prop` / `boolean`                   | `prop` / `boolean`                    | `prop` / `boolean`                      | `prop` / `boolean`                | `prop` / `boolean`                    | `prop` / `boolean`                     | `prop` / `boolean`              | `prop` / `boolean`                 | `prop` / `boolean`                     |
| `length`                                                                        | ✔️                       | `-` / `number`                       | N/A                                   | N/A                                     | N/A                               | `-` / `number`                        | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `charAt(pos: number \| deep.Number)`                                                | ⚙️                       | `pos` / `string`                     | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `charCodeAt(pos: number \| deep.Number)`                                             | ⚙️                       | `pos` / `number`                     | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `concat(...items: any[])`                                                       | ⚙️                       | `strings` / `string`                 | N/A                                   | N/A                                     | N/A                               | `arrs` / `deep.Array` (wrapped)     | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `includes(search: any, pos?: number \| deep.Number)`                                | ⚙️                       | `search,pos` / `boolean`             | N/A                                   | N/A                                     | N/A                               | `item,from` / `boolean`               | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `endsWith(search: string \| deep.String, len?: number \| deep.Number)`                  | ⚙️                       | `search,len` / `boolean`             | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `indexOf(search: any, pos?: number \| deep.Number)`                                  | ⚙️                       | `search,pos` / `number`              | N/A                                   | N/A                                     | N/A                               | `item,from` / `number`                | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `lastIndexOf(search: any, pos?: number \| deep.Number)`                              | ⚙️                       | `search,pos` / `number`              | N/A                                   | N/A                                     | N/A                               | `item,from` / `number`                | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `localeCompare(compare: string \| deep.String, locales?: string \| deep.String \| (string \| deep.String)[], opts?: object)` | ⚙️ | `compare,...` / `number`           | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `match(regexp: string \| deep.String \| deep.RegExp)`                                  | ⚙️                       | `regexp` / `deep.Array<deep.String> \| null` | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `matchAll(regexp: string \| deep.String \| deep.RegExp)`                               | ⚙️                       | `regexp` / `Iterator<Deep[]>` (wrapped) | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `normalize(form?: string \| deep.String)`                                            | ⚙️                       | `form` / `string`                    | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `padEnd(len: number \| deep.Number, pad?: string \| deep.String)`                        | ⚙️                       | `len,pad` / `string`                 | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `padStart(len: number \| deep.Number, pad?: string \| deep.String)`                      | ⚙️                       | `len,pad` / `string`                 | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `repeat(count: number \| deep.Number)`                                                | ⚙️                       | `count` / `string`                   | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `replace(pattern: string \| deep.String \| deep.RegExp, replacement: string \| deep.String \| Function)` | ⚙️ | `pattern,repl` / `string`          | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `replaceAll(pattern: string \| deep.String \| deep.RegExp, replacement: string \| deep.String \| Function)`| ⚙️ | `pattern,repl` / `string`          | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `search(regexp: string \| deep.String \| deep.RegExp)`                                  | ⚙️                       | `regexp` / `number`                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `slice(start?: number \| deep.Number, end?: number \| deep.Number)`                      | ⚙️                       | `start,end` / `string`               | N/A                                   | N/A                                     | N/A                               | `start,end` / `deep.Array` (wrapped)| N/A                                    | N/A                             | N/A                                | N/A                                    |
| `split(separator?: string \| deep.String \| deep.RegExp, limit?: number \| deep.Number)`  | ⚙️                       | `sep,limit` / `deep.Array<deep.String>` | N/A                                | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `startsWith(search: string \| deep.String, pos?: number \| deep.Number)`                  | ⚙️                       | `search,pos` / `boolean`             | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `substring(start: number \| deep.Number, end?: number \| deep.Number)`                      | ⚙️                       | `start,end` / `string`               | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toLocaleLowerCase(locales?: string \| deep.String \| (string \| deep.String)[])`        | ⚙️                       | `locales` / `string`                 | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toLocaleUpperCase(locales?: string \| deep.String \| (string \| deep.String)[])`        | ⚙️                       | `locales` / `string`                 | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toLowerCase()`                                                                 | ⚙️                       | `-` / `string`                       | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toUpperCase()`                                                                 | ⚙️                       | `-` / `string`                       | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `trim()`                                                                        | ⚙️                       | `-` / `string`                       | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `trimStart()` (trimLeft)                                                        | ⚙️                       | `-` / `string`                       | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `trimEnd()` (trimRight)                                                         | ⚙️                       | `-` / `string`                       | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toExponential(digits?: number \| deep.Number)`                                     | ⚙️                       | N/A                                  | `digits` / `string`                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toFixed(digits?: number \| deep.Number)`                                        | ⚙️                       | N/A                                  | `digits` / `string`                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `toPrecision(precision?: number \| deep.Number)`                                  | ⚙️                       | N/A                                  | `precision` / `string`                | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `add(value: any)`                                                               | ✔️                       | N/A                                  | N/A                                   | N/A                                     | `value` / `this (deep.Set)`       | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `clear()`                                                                       | ✔️                       | N/A                                  | N/A                                   | N/A                                     | `-` / `undefined`                 | N/A                                   | N/A                                    | `-` / `undefined`                 | N/A                                | N/A                                    |
| `delete(value: any)`                                                            | ✔️                       | N/A                                  | N/A                                   | N/A                                     | `value` / `boolean`               | N/A                                   | N/A                                    | `key` / `boolean`                 | N/A                                | N/A                                    |
| `has(value: any)`                                                               | ✔️                       | N/A                                  | N/A                                   | N/A                                     | `value` / `boolean`               | N/A                                   | N/A                                    | `key` / `boolean`                 | N/A                                | N/A                                    |
| `size`                                                                          | ✔️                       | N/A                                  | N/A                                   | N/A                                     | `-` / `number`                    | N/A                                   | N/A                                    | `-` / `number`                    | N/A                                | N/A                                    |
| `entries()`                                                                     | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `-` / `Iterator<[Deep,Deep]>` (wrapped) | `Iterator<[Deep,Deep]>` (wrapped) | N/A                                    | `-` / `Iterator<[Deep,Deep]>` (wrapped) | N/A | N/A                             |
| `forEach(cb: (val: Deep, key: Deep, collection: Deep) => void, thisArg?: any)`   | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `cb,thisArg` / `undefined`        | `cb,thisArg` / `undefined`            | N/A                                    | `cb,thisArg` / `undefined`        | N/A                                | N/A                                    |
| `keys()`                                                                        | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `-` / `Iterator<Deep>` (wrapped)| `-` / `Iterator<Deep>` (wrapped)| N/A                                    | `-` / `Iterator<Deep>` (wrapped)| N/A                                | N/A                                    |
| `values()`                                                                      | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `-` / `Iterator<Deep>` (wrapped)| `-` / `Iterator<Deep>` (wrapped)| N/A                                    | `-` / `Iterator<Deep>` (wrapped)| N/A                                | N/A                                    |
| `difference(B: deep.Set)`                                                       | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `deep.Set` (wrapped)        | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `intersection(B: deep.Set)`                                                     | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `deep.Set` (wrapped)        | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `symmetricDifference(B: deep.Set)`                                              | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `deep.Set` (wrapped)        | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `union(B: deep.Set)`                                                            | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `deep.Set` (wrapped)        | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `isDisjointFrom(B: deep.Set)`                                                   | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `boolean`                   | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `isSubsetOf(B: deep.Set)`                                                       | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `boolean`                   | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `isSupersetOf(B: deep.Set)`                                                     | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | `B` / `boolean`                   | N/A                                   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `push(...items: any[])`                                                         | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `items` / `number` (new length)     | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `pop()`                                                                         | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `-` / `Deep \| undefined` (wrapped) | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `shift()`                                                                       | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `-` / `Deep \| undefined` (wrapped) | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `unshift(...items: any[])`                                                      | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `items` / `number` (new length)     | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `join(sep?: string \| deep.String)`                                                | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `sep` / `string`                      | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `map(cb: (val: Deep, idx: deep.Number, arr: deep.Array) => any, thisArg?: any)`    | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `cb,thisArg` / `deep.Array` (wrapped)| N/A                                    | N/A                             | N/A                                | N/A                                    |
| `filter(cb: (val: Deep, idx: deep.Number, arr: deep.Array) => boolean, thisArg?: any)`| ⚙️ | N/A                                 | N/A                                   | N/A                                     | N/A                               | `cb,thisArg` / `deep.Array` (wrapped)| N/A                                    | N/A                             | N/A                                | N/A                                    |
| `every(cb: (val: Deep, idx: deep.Number, arr: deep.Array) => boolean, thisArg?: any)` | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `cb,thisArg` / `boolean`              | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `some(cb: (val: Deep, idx: deep.Number, arr: deep.Array) => boolean, thisArg?: any)`  | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `cb,thisArg` / `boolean`              | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `reduce(cb: (acc: Deep, val: Deep, idx: deep.Number, arr: deep.Array) => Deep, initial?: Deep)` | ⚙️         | N/A                                  | N/A                                   | N/A                                     | N/A                               | `cb,initial` / `Deep` (wrapped)     | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `find(cb: (val: Deep, idx: deep.Number, arr: deep.Array) => boolean, thisArg?: any)`  | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `cb,thisArg` / `Deep \| undefined` (wrapped) | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `sort(compareFn?: (a: Deep, b: Deep) => number \| deep.Number)`                       | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `compareFn` / `this (deep.Array)`   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `reverse()`                                                                     | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `-` / `this (deep.Array)`           | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `splice(start: number \| deep.Number, deleteCount?: number \| deep.Number, ...items: any[])`| ⚙️ | N/A                                | N/A                                   | N/A                                     | N/A                               | `start,...` / `deep.Array` (wrapped)| N/A                                    | N/A                             | N/A                                | N/A                                    |
| `fill(value: any, start?: number \| deep.Number, end?: number \| deep.Number)`         | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `value,...` / `this (deep.Array)`   | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `copyWithin(target: number \| deep.Number, start?: number \| deep.Number, end?: number \| deep.Number)`| ⚙️ | N/A                             | N/A                                   | N/A                                     | N/A                               | `target,...` / `this (deep.Array)`  | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `flat(depth?: number \| deep.Number)`                                               | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `depth` / `deep.Array` (wrapped)    | N/A                                    | N/A                             | N/A                                | N/A                                    |
| `flatMap(cb: (val: Deep, idx: deep.Number, arr: deep.Array) => any, thisArg?: any)`| ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | `cb,thisArg` / `deep.Array` (wrapped)| N/A                                    | N/A                             | N/A                                | N/A                                    |
| `set(key: any, value: any)`                                                       | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | `key,value` / `this (deep.Map)` | N/A                                | N/A                                    |
| `get(key: any)`                                                                 | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | `key` / `Deep \| undefined` (wrapped) | N/A                                | N/A                                    |
| `getFullYear()`                                                                 | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `-` / `number`                     | N/A                                    |
| `getMonth()`                                                                    | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `-` / `number`                     | N/A                                    |
| `getDate()`                                                                     | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `-` / `number`                     | N/A                                    |
| `setFullYear(year: number \| deep.Number, month?: number \| deep.Number, date?: number \| deep.Number)`| ⚙️ | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `year,...` / `number` (timestamp)| N/A                                    |
| `getHours()`                                                                  | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `-` / `number`                     | N/A                                    |
| `setHours()`                                                                  | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `hour,...` / `number` (timestamp)| N/A                                    |
| `toISOString()`                                                               | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | `-` / `string`                     | N/A                                    |
| `test(string: string \| deep.String)`                                                | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | `string` / `boolean`                   |
| `exec(string: string \| deep.String)`                                                | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | `string` / `deep.Array<deep.String> \| null` |
| `flags`                                                                         | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | `-` / `string`                         |
| `source`                                                                        | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | `-` / `string`                         |
| `global`                                                                        | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | `-` / `boolean`                        |
| `ignoreCase`                                                                    | ⚙️                       | N/A                                  | N/A                                   | N/A                                     | N/A                               | N/A                                   | N/A                                    | N/A                             | N/A                                | `-` / `boolean`                        |

**Table Legend:**
*   **Common `.val` forwarding**: Indicates if the mechanism for delegating the call to the `.val` instance is implemented.
*   **`<DEEP_TYPE>` accepts / returns**:
    *   Before `/`: Argument types the method expects (after `deep.detect(arg)._data`).
    *   After `/`: Return value type (primitive or Deep wrapper).
*   ✔️ - Fully implemented and tested according to principles.
*   ⚙️ - In development or requires refinement to meet principles.
*   ❌ - Implementation not started.
*   N/A - Not applicable for this type.

*(Note: This table is VERY extensive and may still contain simplifications for brevity. Some methods (especially static ones like `Object.keys`) might require separate implementation in `deep.Object` or the corresponding module, rather than through the common `wrapData` mechanism for instances. For callbacks in methods like `forEach`, `map`, etc., arguments (`val`, `key`/`idx`, `collection`) will be passed to the callback as Deep instances.)*

---
Next, I will proceed to create `detect.ts`.
